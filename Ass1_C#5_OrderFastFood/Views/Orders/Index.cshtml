@model IEnumerable<Ass1_C_5_OrderFastFood.Models.Order>
@{
    ViewBag.Title = "Quản lý Đơn hàng";
}

<h2 class="mb-4 text-primary"><i class="fas fa-box"></i> @ViewBag.Title</h2>

<div class="mb-4 p-3 border rounded shadow-sm bg-light">
    <form method="get" class="d-flex align-items-center">
        <label for="status" class="form-label me-3 fw-bold mb-0">Lọc theo trạng thái:</label>
        <select name="status" id="status" class="form-select" style="width: auto;" onchange="this.form.submit()">
            <option value="">-- Tất cả --</option>
            @foreach (var status in Enum.GetValues(typeof(Ass1_C_5_OrderFastFood.Models.OrderStatus)))
            {
                <option value="@status" selected="@(ViewBag.CurrentStatus != null && status.Equals(ViewBag.CurrentStatus))">
                    @status
                </option>
            }
        </select>
        <a asp-action="Index" class="btn btn-outline-secondary ms-2" title="Reset"><i class="fas fa-redo"></i> Reset</a>
    </form>
</div>

<div class="card shadow">
    <div class="card-body p-0">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th style="width: 5%;">ID</th>
                    <th style="width: 20%;">Khách hàng</th>
                    <th style="width: 15%;">Tổng</th>
                    <th style="width: 20%;">Trạng thái</th>
                    <th style="width: 25%;">Ngày tạo</th>
                    <th style="width: 15%;">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td class="fw-bold">#@order.Id</td>
                        <td>@order.ApplicationUser?.UserName</td>
                        <td class="text-danger fw-bold">@string.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:C0}", order.Total)</td>
                        <td>
                            @{
                                // Dùng badge cho trạng thái đẹp hơn
                                var statusClass = order.Status switch
                                {
                                    Ass1_C_5_OrderFastFood.Models.OrderStatus.Pending => "bg-warning text-dark",
                                    Ass1_C_5_OrderFastFood.Models.OrderStatus.Processing => "bg-info",
                                    Ass1_C_5_OrderFastFood.Models.OrderStatus.Delivered => "bg-success",
                                    Ass1_C_5_OrderFastFood.Models.OrderStatus.Cancelled => "bg-danger",
                                    _ => "bg-secondary"
                                };
                            }
                            <span class="badge @statusClass">@order.Status</span>
                        </td>
                        <td>@order.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            <a asp-action="Details" asp-route-id="@order.Id" class="btn btn-info btn-sm">
                                <i class="fas fa-info-circle"></i> Chi tiết
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>